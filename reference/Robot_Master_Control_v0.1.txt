// ===============================================================================================
// MASTER CONTROL ROBOT - PORTFÃ–Y YÃ–NETÄ°M SÄ°STEMÄ°
// ===============================================================================================
// KONSEPT TASARIMI v0.1
// 
// AMAÃ‡:
// TÃ¼m stratejileri merkezi olarak yÃ¶netmek, pozisyon boyutlandÄ±rma yapmak,
// risk limitleri uygulamak ve portfÃ¶y Ã§eÅŸitlendirmesini kontrol etmek.
//
// Tarih: 2026-01-24
// ===============================================================================================

// ===============================================================================================
// BÃ–LÃœM 1: GENEL AYARLAR
// ===============================================================================================

// Sermaye AyarlarÄ±
var TOPLAM_SERMAYE = 100000.0;     // Toplam portfÃ¶y deÄŸeri (TL)
var MAX_RISK_ISLEM = 2.0;          // Her iÅŸlemde max risk (% olarak)
var MAX_RISK_GUNLUK = 5.0;         // GÃ¼nlÃ¼k max kayÄ±p limiti (%)
var MAX_RISK_HAFTALIK = 10.0;      // HaftalÄ±k max kayÄ±p limiti (%)

// Pozisyon Limitleri
var MAX_ACIK_POZISYON = 3;         // AynÄ± anda max aÃ§Ä±k pozisyon sayÄ±sÄ±
var MAX_TEKRAR_SEMBOL = 1;         // AynÄ± sembolde max pozisyon
var MAX_TEKRAR_YON = 2;            // AynÄ± yÃ¶nde (Long/Short) max pozisyon

// Kontrat DeÄŸerleri (GÃ¼ncellenmeli)
var XU030_KONTRAT_DEGERI = 100.0;  // 1 puan = 100 TL
var USDTRY_KONTRAT_DEGERI = 1000.0;

// ===============================================================================================
// BÃ–LÃœM 2: STRATEJÄ° TANIMLARI
// ===============================================================================================
/*
YÃ¶netilecek stratejiler:
1. ARS_Trend_5DK     - F_XU030 - Trend takip
2. ARS_Trend_15DK    - F_XU030 - Trend takip
3. Endeks_Vadeli     - F_XU030 - Breakout
4. VIOP_Scalp        - F_USDTRY - Scalping (gelecekte)

Her strateji iÃ§in:
- Sistem adÄ±
- Sembol
- Periyot
- AÄŸÄ±rlÄ±k (portfÃ¶y iÃ§indeki oran)
- Aktif/Pasif durumu
*/

// Strateji listesi (SozcukTablosundan okunabilir)
string[] STRATEJI_LISTESI = new string[] {
    "ARS_Trend_5DK|F_XU030|5|0.40|AKTIF",
    "ARS_Trend_15DK|F_XU030|15|0.30|AKTIF",
    "Endeks_Vadeli|F_XU030|15|0.30|PASIF"
};

// ===============================================================================================
// BÃ–LÃœM 3: MEVCUT DURUM OKUMA
// ===============================================================================================

// IdealData'dan mevcut pozisyonlarÄ± oku
// var ViopHesap = Sistem.ViopHesapOku();
// var AcikPozisyonlar = Sistem.ViopPozisyonlar(1000);

// GÃ¼nlÃ¼k KZ hesaplama
// var GunlukKZ = HesaplaGunlukKZ();

// ===============================================================================================
// BÃ–LÃœM 4: RÄ°SK KONTROL FONKSÄ°YONLARI
// ===============================================================================================

/*
// GÃ¼nlÃ¼k limit kontrolÃ¼
bool GunlukLimitKontrol()
{
    float gunlukKayip = HesaplaGunlukKZ();
    float limitTL = (float)(TOPLAM_SERMAYE * MAX_RISK_GUNLUK / 100);
    
    if (gunlukKayip <= -limitTL)
    {
        Sistem.Mesaj("âš ï¸ GÃœNLÃœK LÄ°MÄ°T AÅILDI! Yeni iÅŸlem yapÄ±lamaz.", Color.Red);
        return false;
    }
    return true;
}

// Pozisyon limiti kontrolÃ¼
bool PozisyonLimitKontrol()
{
    int acikSayi = AcikPozisyonlar.Count;
    if (acikSayi >= MAX_ACIK_POZISYON)
    {
        Sistem.Mesaj("âš ï¸ MAX POZÄ°SYON LÄ°MÄ°TÄ°! " + acikSayi + "/" + MAX_ACIK_POZISYON, Color.Orange);
        return false;
    }
    return true;
}
*/

// ===============================================================================================
// BÃ–LÃœM 5: LOT HESAPLAMA
// ===============================================================================================

/*
// Risk bazlÄ± lot hesaplama
int HesaplaLot(string sembol, float girisFiyat, float stopFiyat)
{
    float riskTL = (float)(TOPLAM_SERMAYE * MAX_RISK_ISLEM / 100);
    float stopMesafesi = Math.Abs(girisFiyat - stopFiyat);
    
    float kontratDegeri = XU030_KONTRAT_DEGERI;
    if (sembol.Contains("USD")) kontratDegeri = USDTRY_KONTRAT_DEGERI;
    
    float kayipPerLot = stopMesafesi * kontratDegeri;
    int lot = (int)(riskTL / kayipPerLot);
    
    return Math.Max(1, lot);  // Minimum 1 lot
}

// Volatilite bazlÄ± lot ayarlama
int VolatiliteAyarlamasiUygula(int lot, float atr, float ortalamaATR)
{
    float volatiliteOrani = atr / ortalamaATR;
    
    if (volatiliteOrani > 1.5) lot = (int)(lot * 0.5);      // Ã‡ok volatil
    else if (volatiliteOrani > 1.2) lot = (int)(lot * 0.75); // Volatil
    else if (volatiliteOrani < 0.8) lot = (int)(lot * 1.25); // Sakin
    
    return Math.Max(1, lot);
}
*/

// ===============================================================================================
// BÃ–LÃœM 6: DRAWDOWN YÃ–NETÄ°MÄ°
// ===============================================================================================

/*
// Drawdown seviyesine gÃ¶re lot Ã§arpanÄ±
float DrawdownCarpani()
{
    float maxDD = (float)Sistem.GetiriMaxDD;
    
    if (maxDD <= -TOPLAM_SERMAYE * 0.2)      // %20+ DD
    {
        Sistem.Mesaj("ğŸ›‘ KRÄ°TÄ°K DRAWDOWN! Ä°ÅŸlemler durduruldu.", Color.Red);
        return 0.0f;
    }
    else if (maxDD <= -TOPLAM_SERMAYE * 0.15) // %15-20 DD
        return 0.25f;
    else if (maxDD <= -TOPLAM_SERMAYE * 0.10) // %10-15 DD
        return 0.50f;
    else if (maxDD <= -TOPLAM_SERMAYE * 0.05) // %5-10 DD
        return 0.75f;
    else
        return 1.0f;
}
*/

// ===============================================================================================
// BÃ–LÃœM 7: ANA KONTROL DÃ–NGÃœSÃœ
// ===============================================================================================

/*
// Her bar'da Ã§alÄ±ÅŸacak ana mantÄ±k
void AnaKontrol()
{
    // 1. Risk limitleri kontrol
    if (!GunlukLimitKontrol()) return;
    if (!PozisyonLimitKontrol()) return;
    
    // 2. Her stratejiyi kontrol et
    foreach (var stratejiStr in STRATEJI_LISTESI)
    {
        var parcalar = stratejiStr.Split('|');
        string sistemAdi = parcalar[0];
        string sembol = parcalar[1];
        string periyot = parcalar[2];
        float agirlik = float.Parse(parcalar[3]);
        string durum = parcalar[4];
        
        if (durum != "AKTIF") continue;
        
        // 3. Strateji sinyalini al
        var sistem = Sistem.SistemGetir(sistemAdi, sembol, periyot);
        string sinyal = Sistem.SonYonGetir(sistemAdi, sembol, periyot);
        
        // 4. Sinyal varsa lot hesapla ve emir gÃ¶nder
        if (sinyal == "A" || sinyal == "S")
        {
            float girisFiyat = Sistem.SonFiyat(sembol);
            float stopFiyat = HesaplaStop(sinyal, girisFiyat);
            
            int lot = HesaplaLot(sembol, girisFiyat, stopFiyat);
            lot = (int)(lot * agirlik);
            lot = (int)(lot * DrawdownCarpani());
            lot = VolatiliteAyarlamasiUygula(lot, atr, ortalamaATR);
            
            if (lot > 0)
            {
                // Emir gÃ¶nder
                // Sistem.EmirGonder(...);
            }
        }
    }
}
*/

// ===============================================================================================
// BÃ–LÃœM 8: BÄ°LGÄ° PANELÄ°
// ===============================================================================================

// Panel gÃ¶sterimi
string panelInfo = "â•â•â•â•â•â• MASTER CONTROL â•â•â•â•â•â•" + Environment.NewLine +
                   "Sermaye: " + TOPLAM_SERMAYE.ToString("N0") + " TL" + Environment.NewLine +
                   "Max Risk/Ä°ÅŸlem: %" + MAX_RISK_ISLEM + Environment.NewLine +
                   "Max Risk/GÃ¼n: %" + MAX_RISK_GUNLUK + Environment.NewLine +
                   "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€" + Environment.NewLine +
                   "Max Pozisyon: " + MAX_ACIK_POZISYON + Environment.NewLine +
                   "Aktif Strateji: 2" + Environment.NewLine +
                   "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€" + Environment.NewLine +
                   "DURUM: BEKLEME";

Sistem.Dortgen(1, 10, 30, 220, 150, Color.DarkBlue, Color.Black, Color.White);
Sistem.GradientYaziEkle(panelInfo, 1, 15, 35, Color.White, Color.LightBlue, "Consolas", 9);

// ===============================================================================================
// GELÄ°ÅTÄ°RME PLANI:
// ===============================================================================================
// v0.2: ViopHesapOku ve ViopPozisyonlar entegrasyonu
// v0.3: EmirGonder fonksiyonu ile gerÃ§ek emir
// v0.4: Telegram bildirimleri
// v0.5: Ä°ÅŸlem geÃ§miÅŸi ve raporlama
// v1.0: Tam otomatik portfÃ¶y yÃ¶netimi
// ===============================================================================================
